<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viaggio di Maksim Grek in Italia</title>

    <!-- Stili di base -->
    <style>
        body { margin: 0; padding: 0; transition: opacity ease-in 0.2s; }
        html, body, #map { height: 100%; width: 100%; }
        #map { position: absolute; top: 0; bottom: 0; right: 0; left: 0; }
    </style>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <!-- Bootstrap e icone -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css">
</head>
<body>
    <!-- Contenitore mappa -->
    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Inizializza la mappa
        var map_var = L.map('map').setView([45.4408, 12.3155], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map_var);

        // Coordinate e popup
        var latlngs = [
            [45.4408, 12.3155], [43.7696, 11.2558], [44.4949, 11.3426],
            [44.8354, 11.6198], [45.4064, 11.8768], [45.4408, 12.3155],
            [45.4642, 9.19], [45.323, 8.4231], [45.4408, 12.3155],
            [45.4064, 11.8768], [44.8354, 11.6198], [44.9968, 11.0546],
            [43.7696, 11.2558], [45.4408, 12.3155], [45.4408, 12.3155],
            [45.4408, 12.3155]
        ];
        var popups = [
            '1. 1492 – Venezia', '2. 1492 – Firenze', '3. 1496 – Bologna',
            '4. 1496 – Ferrara', '5. 1496 – Padova', '6. 1496 – Venezia',
            '7. 1497 – Milano', '8. 1497 – Vercelli', '9. 1497 – Venezia',
            '10. 1497 – Padova', '11. 1497 – Ferrara', '12. 1498 – Mirandola',
            '13. 1502 – Firenze', '14. 1503 – Venezia', '15. 1504 – Venezia',
            '16. 1506 – Venezia'
        ];

        // Icona personalizzata
        var greenIcon = L.icon({
            iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",
            shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Marker e polilinea
        var marker = L.marker(latlngs[0], {icon: greenIcon}).addTo(map_var);
        var polyline = L.polyline([latlngs[0]], {color:'green', weight:3, opacity:0.8}).addTo(map_var);

        // Variabili animazione
        var i = 1;
        var playing = false;
        var timer = null;

        function animate() {
            if (i < latlngs.length) {
                marker.setLatLng(latlngs[i]);
                marker.bindPopup(popups[i]).openPopup();
                polyline.addLatLng(latlngs[i]);
                i++;
                if (playing) {
                    timer = setTimeout(animate, 1000);
                }
            } else {
                playing = false;
                i = 0;
            }
        }

        function togglePlay() {
            if (!playing) {
                playing = true;
                animate();
            } else {
                playing = false;
                clearTimeout(timer);
            }
        }

        // Pulsante Play/Pausa
        var playButton = L.control({position:'topright'});
        playButton.onAdd = function(map){
            var div = L.DomUtil.create('div','leaflet-bar leaflet-control leaflet-control-custom');
            div.innerHTML = `
                <div style="text-align:center;">
                    <button style="background:white; border:none; padding:10px 20px; font-size:18px; font-weight:bold; cursor:pointer; border-radius:5px; box-shadow:1px 1px 5px rgba(0,0,0,0.3);">
                        ▶️ Play/Pausa
                    </button>
                    <div style="margin-top:5px; font-size:14px; font-weight:bold; color:#333; background:#f9f9f9; padding:5px 10px; border-radius:5px; box-shadow:1px 1px 3px rgba(0,0,0,0.2);">
                        Viaggio di Maksim Grek in Italia
                    </div>
                </div>
            `;
            div.querySelector("button").onclick = togglePlay;
            return div;
        };
        playButton.addTo(map_var);
    </script>
</body>
</html>
