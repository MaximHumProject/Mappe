<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Mappa Waldseem√ºller 1507 - Marker Pixel</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  html, body { height: 100%; margin: 0; }
  #map { width: 1200px; height: 700px; background: #000; }
</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="leaflet-iiif.js"></script>

<script>
const iiifUrl = 'https://tile.loc.gov/image-services/iiif/service:gmd:gmd3:g3200:g3200:ct000725C/info.json';

// Marker definiti con coordinate pixel reali
const markers = [
   
    { name: "Click Test", x: 2077, y: -1405 },
      {name: "Venezia", x: 2095, y: -1385}
 
 // Marker aggiunto
];
const markers1 = [
   
    { name: "Click Test", x: 2077, y: -1600 },
      
 
 // Marker aggiunto
];

const scale = 20;  // scala per adattare layer e marker al div

fetch(iiifUrl)
    .then(res => res.json())
    .then(manifest => {
        const w = manifest.width;
        const h = manifest.height;

        if (!w || !h) { console.error("Dimensioni manifesto IIIF non disponibili"); return; }
        console.log("Dimensioni manifesto:", w, h);

        const map = L.map('map', { crs: L.CRS.Simple, minZoom: 0, maxZoom: 5 });

        const iiifLayer = L.tileLayer.iiif(iiifUrl, { attribution: '&copy; Library of Congress', noWrap: true });
        iiifLayer.addTo(map);

        const bounds = [[0,0],[h/scale, w/scale]];
        map.fitBounds(bounds);
        console.log("Bounds scalati:", bounds);

        iiifLayer.on('load', function() {
            const redMarker = L.divIcon({
                html: '<i class="fa-solid fa-location-dot" style="color:#e00b0b; font-size:24px;"></i>',
                className: 'custom-fa-marker',
                iconSize: [24,24],
                iconAnchor: [12,24]
            });

            // Aggiungi tutti i marker scalati
            markers.forEach(m => {
                let scaledY = m.y / scale;
                let scaledX = m.x / scale;
           
                // Se y negativa, impostiamo 0 per renderlo visibile
               

                const scaled = [scaledY, scaledX];
                L.marker(scaled, {icon: redMarker})
                 .addTo(map)
                 .bindPopup(`<b>${m.name}</b>`);
                console.log(`Marker ${m.name} aggiunto a`, scaled);
            });
            // Aggiungi tutti i marker scalati
         
        });
 iiifLayer.on('load', function() {
            const redMarker = L.divIcon({
                html: '<i class="fa-solid fa-location-dot" style="color:#e00b0b; font-size:36px;"></i>',
                className: 'custom-fa-marker',
                iconSize: [24,24],
                iconAnchor: [12,24]
            });

            // Aggiungi tutti i marker scalati
            markers1.forEach(m => {
                let scaledY = m.y / scale;
                let scaledX = m.x / scale;
           
                // Se y negativa, impostiamo 0 per renderlo visibile
               

                const scaled = [scaledY, scaledX];
                L.marker(scaled, {icon: redMarker})
                 .addTo(map)
                 .bindPopup(`<b>${m.name}</b>`);
                console.log(`Marker ${m.name} aggiunto a`, scaled);
            });
            // Aggiungi tutti i marker scalati
         
        });
    })
    .catch(err => console.error("Errore caricamento manifesto IIIF:", err));
</script>
</body>
</html>
