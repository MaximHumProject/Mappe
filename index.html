
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Mappa Storica Waldseem√ºller</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<style>
  html, body { height: 100%; margin: 0; }
  #map-storica { width: 1200px; height: 700px; margin: 0 auto; }
</style>
</head>
<body>
<div id="map-storica"></div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="leaflet-iiif.js"></script>
<script>
var mapStorica = L.map('map-storica', {
    crs: L.CRS.Simple,
    minZoom: 0,
    maxZoom: 8
});

var iiifLayer = L.tileLayer.iiif("https://tile.loc.gov/image-services/iiif/service:gmd:gmd3:g3200:g3200:ct000725C/info.json", {
    attribution: '&copy; Library of Congress',
    noWrap: true
}).addTo(mapStorica);

var imageWidth = 0;
var imageHeight = 0;

fetch("https://tile.loc.gov/image-services/iiif/service:gmd:gmd3:g3200:g3200:ct000725C/info.json")
  .then(res => res.json())
  .then(manifest => {
    imageWidth = manifest.width;
    imageHeight = manifest.height;
    mapStorica.fitBounds([[0,0],[imageHeight/20, imageWidth/20]]);
  });

// Aggiungi marker di esempio
const punti = [{'x': 2095, 'y': 1385, 'nome': 'Venezia'}, {'x': 2763, 'y': 1325, 'nome': 'Mosca'}, {'x': 2300, 'y': 1500, 'nome': 'Roma'}];
punti.forEach(function(p){
    L.marker([-p.y/20, p.x/20]).addTo(mapStorica).bindPopup(p.nome);
});

// === RACCOLTA COORDINATE IN PIXEL ===
mapStorica.on('click', function(e) {
    if (!imageWidth || !imageHeight) return;

    // Conversione inversa: da coordinate Leaflet a pixel reali
    var x_pixel = e.latlng.lng * 20;
    var y_pixel = -e.latlng.lat * 20;

    console.log("Coordinate pixel:", x_pixel.toFixed(0), y_pixel.toFixed(0));

    L.popup()
      .setLatLng(e.latlng)
      .setContent("Pixel X: " + x_pixel.toFixed(0) + "<br>Pixel Y: " + y_pixel.toFixed(0))
      .openOn(mapStorica);
});
</script>
</body>
</html>
